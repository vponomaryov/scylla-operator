


<!doctype html>
<html class="no-js" lang="en">
  
<head><!-- begin head.html -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>
    Version migrations | Scylla Docs
    </title>
    <meta name="description" content="Scylla is an Apache Cassandra-compatible NoSQL data store that can handle 1 million transactions per second on a single server."/>

    <link rel="icon" href="_static/img/favicon.ico" type="image/x-icon"/>
    <link rel="canonical" href="https://docs.scylladb.com/">

    <link rel="author" href="mailto:info@scylladb.com">
    <link rel="stylesheet" href="_static/" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx_tabs/semantic-ui-2.4.1/segment.min.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx_tabs/semantic-ui-2.4.1/menu.min.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx_tabs/semantic-ui-2.4.1/tab.min.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx_tabs/tabs.css" />
    
    <link href='https://fonts.googleapis.com/css?family=Roboto:400,100,300,500,700' rel='stylesheet' type='text/css'>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/foundation/5.5.2/css/foundation.min.css" type="text/css" />
    <link rel="stylesheet" href="_static/css/doc/main.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" />
    <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>

    <script src="_static/js/vendor/modernizr.js"></script>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
      new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-T8P2JP');</script>
    <!-- End Google Tag Manager -->

    <!-- Marketo -->
    <script type="text/javascript"> (function() { var didInit = false; function initMunchkin() { if(didInit === false) { didInit = true; Munchkin.init('791-QBF-350'); } } var s = document.createElement('script'); s.type = 'text/javascript'; s.async = true; s.src = '//munchkin.marketo.net/munchkin.js'; s.onreadystatechange = function() { if (this.readyState == 'complete' || this.readyState == 'loaded') { initMunchkin(); } }; s.onload = initMunchkin; document.getElementsByTagName('head')[0].appendChild(s); })(); </script>
    <!-- End Marketo -->

<!-- end head.html -->
</head>

<body>



<header id="header" class="animated">
    <div class="topbar_continer contain-to-grid clearfix">
        <nav class="top-bar" id="top-bar" data-topbar role="navigation">
            <ul class="title-area">
                <li class="name">
                    <div class="logo">
                        <a href="https://docs.scylladb.com/"><img src="_static/img/logo-scylla-docs.svg" alt="" width="151"></a>
                    </div>
                </li>
                <li class="toggle-topbar"><a href="#"><span class="icon-manu"></span></a></li>
            </ul>
            <section class="top-bar-section clearfix">
                <ul class="right">
                    
                    <li>
                        <a href="https://scylladb.github.io/scylla-operator/">Scylla Operator</a>
                    </li>
                    
                    <li>
                        <a href="https://docs.scylladb.com/scylla-cloud/">Scylla Cloud</a>
                    </li>
                    
                    <li>
                        <a href="https://university.scylladb.com/">Scylla University</a>
                    </li>
                    
                    <li>
                        <a href="https://www.scylladb.com/">ScyllaDB Home</a>
                    </li>
                    
                    <li class="search_continer show-for-medium-up">	
                        <ci-search></ci-search>	
                    </li>	
                </ul>
            </section>
        </nav>
    </div>
</header>
<section id="content">
    <div class="row">
	
	<div class="large-6 large-push-3 columns">

        

        <div class="section" id="version-migrations">
<h1>Version  migrations<a class="headerlink" href="#version-migrations" title="Permalink to this headline">¶</a></h1>
</div>
<div class="section" id="v0-3-0-v1-0-0-migration">
<h1><code class="docutils literal notranslate"><span class="pre">v0.3.0</span></code> -&gt; <code class="docutils literal notranslate"><span class="pre">v1.0.0</span></code> migration<a class="headerlink" href="#v0-3-0-v1-0-0-migration" title="Permalink to this headline">¶</a></h1>
<p><code class="docutils literal notranslate"><span class="pre">v0.3.0</span></code> used a very common name as a CRD kind (<code class="docutils literal notranslate"><span class="pre">Cluster</span></code>). In <code class="docutils literal notranslate"><span class="pre">v1.0.0</span></code> this issue was solved by using less common kind
which is easier to disambiguate (<code class="docutils literal notranslate"><span class="pre">ScyllaCluster</span></code>).
<em><strong>This change is backward incompatible, which means manual migration is needed.</strong></em></p>
<p>This procedure involves having two CRDs registered at the same time. We will detach Scylla Pods
from Scylla Operator for a short period to ensure that nothing is garbage collected when Scylla Operator is upgraded.
Compared to the <a class="reference internal" href="upgrade.html"><span class="doc">upgrade guide</span></a> where full deletion is requested, this procedure shouldn’t cause downtimes.
Although detaching resources from their controller is considered hacky. This means that you shouldn’t run procedure
out of the box on production. Make sure this procedure works well multiple times on your staging environment first.</p>
<p><em><strong>Read the whole procedure and make sure you understand what is going on before executing any of the commands!</strong></em></p>
<p>In case of any issues or questions regarding this procedure, you’re welcomed on our <a class="reference external" href="http://slack.scylladb.com/">Scylla Users Slack</a>
on #kubernetes channel.</p>
<div class="section" id="procedure">
<h2>Procedure<a class="headerlink" href="#procedure" title="Permalink to this headline">¶</a></h2>
<ol>
<li><p>Execute this whole procedure for each cluster sequentially. To get a list of existing clusters execute the following</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kubectl</span> <span class="o">-</span><span class="n">n</span> <span class="n">scylla</span> <span class="n">get</span> <span class="n">cluster</span><span class="o">.</span><span class="n">scylla</span><span class="o">.</span><span class="n">scylladb</span><span class="o">.</span><span class="n">com</span>

<span class="n">NAME</span>             <span class="n">AGE</span>
<span class="n">simple</span><span class="o">-</span><span class="n">cluster</span>   <span class="mi">30</span><span class="n">m</span>
</pre></div>
</div>
<p>All below commands will use <code class="docutils literal notranslate"><span class="pre">scylla</span></code> namespace and <code class="docutils literal notranslate"><span class="pre">simple-cluster</span></code> as a cluster name.</p>
</li>
<li><p>Make sure you’re using v1.0.0 tag:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">git</span> <span class="n">checkout</span> <span class="n">v1</span><span class="o">.</span><span class="mf">0.0</span>
</pre></div>
</div>
</li>
<li><p>Upgrade your <code class="docutils literal notranslate"><span class="pre">cert-manager</span></code> to <code class="docutils literal notranslate"><span class="pre">v1.0.0</span></code>. If you installed it from a static file from this repo, simply execute the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">kubectl</span> <span class="n">apply</span> <span class="o">-</span><span class="n">f</span> <span class="n">examples</span><span class="o">/</span><span class="n">common</span><span class="o">/</span><span class="n">cert</span><span class="o">-</span><span class="n">manager</span><span class="o">.</span><span class="n">yaml</span>
</pre></div>
</div>
<p>If your <code class="docutils literal notranslate"><span class="pre">cert-manager</span></code> was installed in another way, follow official instructions on <code class="docutils literal notranslate"><span class="pre">cert-manager</span></code> website.</p>
</li>
<li><p><code class="docutils literal notranslate"><span class="pre">examples/common/operator.yaml</span></code> file contains multiple resources. Extract <strong>only</strong> <code class="docutils literal notranslate"><span class="pre">CustomResourceDefinition</span></code> to separate file.</p></li>
<li><p>Install v1.0.0 CRD definition from file created in the previous step:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kubectl</span> <span class="n">apply</span> <span class="o">-</span><span class="n">f</span> <span class="n">examples</span><span class="o">/</span><span class="n">common</span><span class="o">/</span><span class="n">crd</span><span class="o">.</span><span class="n">yaml</span>
</pre></div>
</div>
</li>
<li><p>Save your existing <code class="docutils literal notranslate"><span class="pre">simple-cluster</span></code> Cluster definition to a file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kubectl</span> <span class="o">-</span><span class="n">n</span> <span class="n">scylla</span> <span class="n">get</span> <span class="n">cluster</span><span class="o">.</span><span class="n">scylla</span><span class="o">.</span><span class="n">scylladb</span><span class="o">.</span><span class="n">com</span> <span class="n">simple</span><span class="o">-</span><span class="n">cluster</span> <span class="o">-</span><span class="n">o</span> <span class="n">yaml</span> <span class="o">&gt;</span> <span class="n">existing</span><span class="o">-</span><span class="n">cluster</span><span class="o">.</span><span class="n">yaml</span>
</pre></div>
</div>
</li>
<li><p>Migrate <code class="docutils literal notranslate"><span class="pre">Kind</span></code> and <code class="docutils literal notranslate"><span class="pre">ApiVersion</span></code> to new values using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sed</span> <span class="o">-</span><span class="n">i</span> <span class="s1">&#39;s/scylla.scylladb.com\/v1alpha1/scylla.scylladb.com\/v1/g&#39;</span> <span class="n">existing</span><span class="o">-</span><span class="n">cluster</span><span class="o">.</span><span class="n">yaml</span>
<span class="n">sed</span> <span class="o">-</span><span class="n">i</span> <span class="s1">&#39;s/kind: Cluster/kind: ScyllaCluster/g&#39;</span> <span class="n">existing</span><span class="o">-</span><span class="n">cluster</span><span class="o">.</span><span class="n">yaml</span>
</pre></div>
</div>
</li>
<li><p>Install migrated CRD instance</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kubectl</span> <span class="n">apply</span> <span class="o">-</span><span class="n">f</span> <span class="n">existing</span><span class="o">-</span><span class="n">cluster</span><span class="o">.</span><span class="n">yaml</span>
</pre></div>
</div>
<p>At this point, we should have two CRDs describing your Scylla cluster, although the new one is not controlled by the Operator.</p>
</li>
<li><p>Get UUID of newly created ScyllaCluster resource:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kubectl</span> <span class="o">-</span><span class="n">n</span> <span class="n">scylla</span> <span class="n">get</span> <span class="n">ScyllaCluster</span> <span class="n">simple</span><span class="o">-</span><span class="n">cluster</span> <span class="o">--</span><span class="n">template</span><span class="o">=</span><span class="s2">&quot;{{ .metadata.uid }}&quot;</span>

<span class="mi">12</span><span class="n">a3678d</span><span class="o">-</span><span class="mi">8511</span><span class="o">-</span><span class="mi">4</span><span class="n">c9c</span><span class="o">-</span><span class="mi">8</span><span class="n">a48</span><span class="o">-</span><span class="n">fa78d3992694</span>
</pre></div>
</div>
<p>Save output UUID somewhere, it will be referred as <code class="docutils literal notranslate"><span class="pre">&lt;new-cluster-uid&gt;</span></code> in commands below.</p>
<p><em><strong>Depending on your shell, you might get additional ‘%’ sign at the end of UUID, make sure to remove it!</strong></em></p>
</li>
<li><p>Upgrade ClusterRole attached to each of the Scylla nodes to grant them permission to lookup Scylla clusters:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kubectl</span> <span class="n">patch</span> <span class="n">ClusterRole</span> <span class="n">simple</span><span class="o">-</span><span class="n">cluster</span><span class="o">-</span><span class="n">member</span> <span class="o">--</span><span class="nb">type</span> <span class="s2">&quot;json&quot;</span> <span class="o">-</span><span class="n">p</span> <span class="s1">&#39;[{&quot;op&quot;:&quot;add&quot;,&quot;path&quot;:&quot;/rules/-&quot;,&quot;value&quot;:{&quot;apiGroups&quot;:[&quot;scylla.scylladb.com&quot;],&quot;resources&quot;:[&quot;scyllaclusters&quot;],&quot;verbs&quot;:[&quot;get&quot;]}}]&#39;</span>
</pre></div>
</div>
<p>Amend role name according to your cluster name, it should look like <code class="docutils literal notranslate"><span class="pre">&lt;scylla-cluster-name&gt;-member</span></code>.</p>
</li>
<li><p>Get a list of all Services associated with your cluster. First get list of all services:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">kubectl</span> <span class="o">-</span><span class="n">n</span> <span class="n">scylla</span> <span class="n">get</span> <span class="n">svc</span> <span class="o">-</span><span class="n">l</span> <span class="s2">&quot;scylla/cluster=simple-cluster&quot;</span>

 <span class="n">NAME</span>                                    <span class="n">TYPE</span>        <span class="n">CLUSTER</span><span class="o">-</span><span class="n">IP</span>     <span class="n">EXTERNAL</span><span class="o">-</span><span class="n">IP</span>   <span class="n">PORT</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>                                                           <span class="n">AGE</span>
 <span class="n">simple</span><span class="o">-</span><span class="n">cluster</span><span class="o">-</span><span class="n">client</span>                   <span class="n">ClusterIP</span>   <span class="kc">None</span>           <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>        <span class="mi">9180</span><span class="o">/</span><span class="n">TCP</span>                                                          <span class="mi">109</span><span class="n">m</span>
 <span class="n">simple</span><span class="o">-</span><span class="n">cluster</span><span class="o">-</span><span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mi">1</span><span class="n">a</span><span class="o">-</span><span class="mi">0</span>   <span class="n">ClusterIP</span>   <span class="mf">10.43</span><span class="o">.</span><span class="mf">23.96</span>    <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>        <span class="mi">7000</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">7001</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">7199</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">10001</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">9042</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">9142</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">9160</span><span class="o">/</span><span class="n">TCP</span>   <span class="mi">109</span><span class="n">m</span>
 <span class="n">simple</span><span class="o">-</span><span class="n">cluster</span><span class="o">-</span><span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mi">1</span><span class="n">a</span><span class="o">-</span><span class="mi">1</span>   <span class="n">ClusterIP</span>   <span class="mf">10.43</span><span class="o">.</span><span class="mf">66.22</span>    <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>        <span class="mi">7000</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">7001</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">7199</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">10001</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">9042</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">9142</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">9160</span><span class="o">/</span><span class="n">TCP</span>   <span class="mi">108</span><span class="n">m</span>
 <span class="n">simple</span><span class="o">-</span><span class="n">cluster</span><span class="o">-</span><span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mi">1</span><span class="n">a</span><span class="o">-</span><span class="mi">2</span>   <span class="n">ClusterIP</span>   <span class="mf">10.43</span><span class="o">.</span><span class="mf">246.25</span>   <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>        <span class="mi">7000</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">7001</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">7199</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">10001</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">9042</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">9142</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">9160</span><span class="o">/</span><span class="n">TCP</span>   <span class="mi">106</span><span class="n">m</span>
</pre></div>
</div>
</li>
<li><p>For each service, change its <code class="docutils literal notranslate"><span class="pre">ownerReference</span></code> to point to new CRD instance:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">kubectl</span> <span class="o">-</span><span class="n">n</span> <span class="n">scylla</span> <span class="n">patch</span> <span class="n">svc</span> <span class="o">&lt;</span><span class="n">cluster</span><span class="o">-</span><span class="n">svc</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span> <span class="o">--</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;json&#39;</span> <span class="o">-</span><span class="n">p</span><span class="o">=</span><span class="s1">&#39;[{&quot;op&quot;: &quot;replace&quot;, &quot;path&quot;: &quot;/metadata/ownerReferences/0/apiVersion&quot;, &quot;value&quot;:&quot;scylla.scylladb.com/v1&quot;}, {&quot;op&quot;: &quot;replace&quot;, &quot;path&quot;: &quot;/metadata/ownerReferences/0/kind&quot;, &quot;value&quot;:&quot;ScyllaCluster&quot;}, {&quot;op&quot;: &quot;replace&quot;, &quot;path&quot;: &quot;/metadata/ownerReferences/0/uid&quot;, &quot;value&quot;:&quot;&lt;new-cluster-uid&gt;&quot;}]&#39;</span>
</pre></div>
</div>
<p>Replace <code class="docutils literal notranslate"><span class="pre">&lt;cluster-svc-name&gt;</span></code> with Service name, and <code class="docutils literal notranslate"><span class="pre">&lt;new-cluster-uid&gt;</span></code> with saved UUID from one of the previous steps.</p>
</li>
<li><p>Get a list of all Services again to see if none was deleted. Check also “Age” column, it shouldn’t be lower than previous result.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">kubectl</span> <span class="o">-</span><span class="n">n</span> <span class="n">scylla</span> <span class="n">get</span> <span class="n">svc</span> <span class="o">-</span><span class="n">l</span> <span class="s2">&quot;scylla/cluster=simple-cluster&quot;</span>

 <span class="n">NAME</span>                                    <span class="n">TYPE</span>        <span class="n">CLUSTER</span><span class="o">-</span><span class="n">IP</span>     <span class="n">EXTERNAL</span><span class="o">-</span><span class="n">IP</span>   <span class="n">PORT</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>                                                           <span class="n">AGE</span>
 <span class="n">simple</span><span class="o">-</span><span class="n">cluster</span><span class="o">-</span><span class="n">client</span>                   <span class="n">ClusterIP</span>   <span class="kc">None</span>           <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>        <span class="mi">9180</span><span class="o">/</span><span class="n">TCP</span>                                                          <span class="mi">110</span><span class="n">m</span>
 <span class="n">simple</span><span class="o">-</span><span class="n">cluster</span><span class="o">-</span><span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mi">1</span><span class="n">a</span><span class="o">-</span><span class="mi">0</span>   <span class="n">ClusterIP</span>   <span class="mf">10.43</span><span class="o">.</span><span class="mf">23.96</span>    <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>        <span class="mi">7000</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">7001</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">7199</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">10001</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">9042</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">9142</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">9160</span><span class="o">/</span><span class="n">TCP</span>   <span class="mi">110</span><span class="n">m</span>
 <span class="n">simple</span><span class="o">-</span><span class="n">cluster</span><span class="o">-</span><span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mi">1</span><span class="n">a</span><span class="o">-</span><span class="mi">1</span>   <span class="n">ClusterIP</span>   <span class="mf">10.43</span><span class="o">.</span><span class="mf">66.22</span>    <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>        <span class="mi">7000</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">7001</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">7199</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">10001</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">9042</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">9142</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">9160</span><span class="o">/</span><span class="n">TCP</span>   <span class="mi">109</span><span class="n">m</span>
 <span class="n">simple</span><span class="o">-</span><span class="n">cluster</span><span class="o">-</span><span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mi">1</span><span class="n">a</span><span class="o">-</span><span class="mi">2</span>   <span class="n">ClusterIP</span>   <span class="mf">10.43</span><span class="o">.</span><span class="mf">246.25</span>   <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>        <span class="mi">7000</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">7001</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">7199</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">10001</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">9042</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">9142</span><span class="o">/</span><span class="n">TCP</span><span class="p">,</span><span class="mi">9160</span><span class="o">/</span><span class="n">TCP</span>   <span class="mi">107</span><span class="n">m</span>
</pre></div>
</div>
</li>
<li><p>Get a list of StatefulSets associated with your cluster:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kubectl</span> <span class="o">-</span><span class="n">n</span> <span class="n">scylla</span> <span class="n">get</span> <span class="n">sts</span> <span class="o">-</span><span class="n">l</span> <span class="s2">&quot;scylla/cluster=simple-cluster&quot;</span>

<span class="n">NAME</span>                                  <span class="n">READY</span>   <span class="n">AGE</span>
<span class="n">simple</span><span class="o">-</span><span class="n">cluster</span><span class="o">-</span><span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mi">1</span><span class="n">a</span>   <span class="mi">3</span><span class="o">/</span><span class="mi">3</span>     <span class="mi">104</span><span class="n">m</span>
</pre></div>
</div>
</li>
<li><p>For each StatefulSet from previous step, change its <code class="docutils literal notranslate"><span class="pre">ownerReference</span></code> to point to new CRD instance.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">kubectl</span> <span class="o">-</span><span class="n">n</span> <span class="n">scylla</span> <span class="n">patch</span> <span class="n">sts</span> <span class="o">&lt;</span><span class="n">cluster</span><span class="o">-</span><span class="n">sts</span><span class="o">-</span><span class="n">name</span><span class="o">&gt;</span> <span class="o">--</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;json&#39;</span> <span class="o">-</span><span class="n">p</span><span class="o">=</span><span class="s1">&#39;[{&quot;op&quot;: &quot;replace&quot;, &quot;path&quot;: &quot;/metadata/ownerReferences/0/apiVersion&quot;, &quot;value&quot;:&quot;scylla.scylladb.com/v1&quot;}, {&quot;op&quot;: &quot;replace&quot;, &quot;path&quot;: &quot;/metadata/ownerReferences/0/kind&quot;, &quot;value&quot;:&quot;ScyllaCluster&quot;}, {&quot;op&quot;: &quot;replace&quot;, &quot;path&quot;: &quot;/metadata/ownerReferences/0/uid&quot;, &quot;value&quot;:&quot;&lt;new-cluster-uid&gt;&quot;}]&#39;</span>
</pre></div>
</div>
<p>Replace <code class="docutils literal notranslate"><span class="pre">&lt;cluster-sts-name&gt;</span></code> with StatefulSet name, and <code class="docutils literal notranslate"><span class="pre">&lt;new-cluster-uid&gt;</span></code> with saved UUID from one of the previous steps.</p>
</li>
<li><p>Now when all k8s resources bound to Scylla are attached to new CRD, we can remove 0.3.0 Operator and old CRD definition.
Checkout <code class="docutils literal notranslate"><span class="pre">v0.3.0</span></code> version, and remove Scylla Operator, and old CRD:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">git</span> <span class="n">checkout</span> <span class="n">v0</span><span class="o">.</span><span class="mf">3.0</span>
 <span class="n">kubectl</span> <span class="n">delete</span> <span class="o">-</span><span class="n">f</span> <span class="n">examples</span><span class="o">/</span><span class="n">generic</span><span class="o">/</span><span class="n">operator</span><span class="o">.</span><span class="n">yaml</span>
</pre></div>
</div>
</li>
<li><p>Checkout <code class="docutils literal notranslate"><span class="pre">v1.0.0</span></code>, and install upgraded Scylla Operator:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">git</span> <span class="n">checkout</span> <span class="n">v1</span><span class="o">.</span><span class="mf">0.0</span>
 <span class="n">kubectl</span> <span class="n">apply</span> <span class="o">-</span><span class="n">f</span> <span class="n">examples</span><span class="o">/</span><span class="n">common</span><span class="o">/</span><span class="n">operator</span><span class="o">.</span><span class="n">yaml</span>
</pre></div>
</div>
</li>
<li><p>Wait until Scylla Operator boots up:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">kubectl</span> <span class="o">-</span><span class="n">n</span> <span class="n">scylla</span><span class="o">-</span><span class="n">operator</span><span class="o">-</span><span class="n">system</span> <span class="n">wait</span> <span class="o">--</span><span class="k">for</span><span class="o">=</span><span class="n">condition</span><span class="o">=</span><span class="n">ready</span> <span class="n">pod</span> <span class="o">--</span><span class="nb">all</span> <span class="o">--</span><span class="n">timeout</span><span class="o">=</span><span class="mi">600</span><span class="n">s</span>
</pre></div>
</div>
</li>
<li><p>Get a list of StatefulSets associated with your cluster:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kubectl</span> <span class="o">-</span><span class="n">n</span> <span class="n">scylla</span> <span class="n">get</span> <span class="n">sts</span> <span class="o">-</span><span class="n">l</span> <span class="s2">&quot;scylla/cluster=simple-cluster&quot;</span>

<span class="n">NAME</span>                                  <span class="n">READY</span>   <span class="n">AGE</span>
<span class="n">simple</span><span class="o">-</span><span class="n">cluster</span><span class="o">-</span><span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">us</span><span class="o">-</span><span class="n">east</span><span class="o">-</span><span class="mi">1</span><span class="n">a</span>   <span class="mi">3</span><span class="o">/</span><span class="mi">3</span>     <span class="mi">104</span><span class="n">m</span>
</pre></div>
</div>
</li>
<li><p>For each StatefulSet from previous step, change its sidecar container image to <code class="docutils literal notranslate"><span class="pre">v1.0.0</span></code>, and wait until change will be propagated. This step will initiate a rolling restart of pods one by one.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kubectl</span> <span class="o">-</span><span class="n">n</span> <span class="n">scylla</span> <span class="n">patch</span> <span class="n">sts</span> <span class="o">&lt;</span><span class="n">cluster</span><span class="o">-</span><span class="n">sts</span><span class="o">&gt;</span> <span class="o">--</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;json&#39;</span> <span class="o">-</span><span class="n">p</span><span class="o">=</span><span class="s1">&#39;[{&quot;op&quot;: &quot;replace&quot;, &quot;path&quot;: &quot;/spec/template/spec/initContainers/0/image&quot;, &quot;value&quot;:&quot;scylladb/scylla-operator:v1.0.0&quot;}]&#39;</span>
<span class="n">kubectl</span> <span class="o">-</span><span class="n">n</span> <span class="n">scylla</span> <span class="n">rollout</span> <span class="n">status</span> <span class="n">sts</span> <span class="o">&lt;</span><span class="n">cluster</span><span class="o">-</span><span class="n">sts</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Replace <code class="docutils literal notranslate"><span class="pre">&lt;cluster-sts-name&gt;</span></code> with StatefulSet name.</p>
</li>
<li><p>If you’re using Scylla Manager, bump Scylla Manager Controller image to <code class="docutils literal notranslate"><span class="pre">v1.0.0</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span> <span class="n">kubectl</span> <span class="o">-</span><span class="n">n</span> <span class="n">scylla</span><span class="o">-</span><span class="n">manager</span><span class="o">-</span><span class="n">system</span> <span class="n">patch</span> <span class="n">sts</span> <span class="n">scylla</span><span class="o">-</span><span class="n">manager</span><span class="o">-</span><span class="n">controller</span> <span class="o">--</span><span class="nb">type</span><span class="o">=</span><span class="s1">&#39;json&#39;</span> <span class="o">-</span><span class="n">p</span><span class="o">=</span><span class="s1">&#39;[{&quot;op&quot;: &quot;replace&quot;, &quot;path&quot;: &quot;/spec/template/spec/containers/0/image&quot;, &quot;value&quot;:&quot;scylladb/scylla-operator:v1.0.0&quot;}]&#39;</span>
</pre></div>
</div>
</li>
<li><p>Your Scylla cluster is now migrated to <code class="docutils literal notranslate"><span class="pre">v1.0.0</span></code>.</p></li>
</ol>
</div>
</div>

        </div>

        <div id="sidebar" class="large-3 large-pull-6 columns"><div class="side-nav">
<ul>
<li class="toctree-l1"><a class="reference internal" href="generic.html">Deploying Scylla on a Kubernetes Cluster</a></li>
<li class="toctree-l1"><a class="reference internal" href="eks.html">Deploying Scylla on EKS (experimental)</a></li>
<li class="toctree-l1"><a class="reference internal" href="gke.html">Deploying Scylla on GKE</a></li>
<li class="toctree-l1"><a class="reference internal" href="manager.html">Deploying Scylla Manager on a Kubernetes Cluster</a></li>
<li class="toctree-l1"><a class="reference internal" href="node_operations.html">Node operations using Scylla Operator</a></li>
<li class="toctree-l1"><a class="reference internal" href="upgrade.html">Upgrade of Scylla Operator</a></li>
<li class="toctree-l1"><a class="reference internal" href="scylla_cluster_crd.html">Scylla Cluster CRD</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">Contributing to Scylla Operator</a></li>
</ul>

</div>
        </div>

        <div class="large-3 columns">
            
                <div class="versions-dropdown ">
    <button class="button">
	v1.0

	 <i class="fa fa-caret-down" aria-hidden="true"></i>
    </button>
    <ul class="content">
            <li><a href="../master/migration.html">master</a></li>
            <li><a href="../v0.3/index.html">v0.3</a></li>
            <li><a href="migration.html">v1.0</a></li>
    </ul>
</div>
            
        </div>

    </div>
</section>

<!-- newsleter modal -->

<div id="newsletter_signup" class="reveal-modal tiny radius dark_modal" data-reveal aria-labelledby="modalTitle" aria-hidden="true" role="dialog">
    <a class="close-reveal-modal" aria-label="Close">×</a>
    <h2 id="modalTitle">Sign up for the Scylla newsletter</h2>
    <div id="mc_embed_signup">
        <form action="//cloudius-systems.us10.list-manage.com/subscribe/post?u=df8bb543c68230d5f7b4dcf78&amp;id=9a4589f144" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate="">
            <div id="mc_embed_signup_scroll">

                <div class="mc-field-group">
                    <div class="row collapse">
                        <div class="small-3 columns"><label for="mce-EMAIL">Email</label></div>
                        <div class="small-9 columns"><input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL"></div>
                    </div>
                </div>
                <div class="mc-field-group">
                    <div class="row collapse">
                        <div class="small-3 columns"><label for="mce-FNAME">First Name </label></div>
                        <div class="small-9 columns"><input type="text" value="" name="FNAME" class="" id="mce-FNAME"></div>
                    </div>
                </div>
                <div class="mc-field-group">
                    <div class="row collapse">
                        <div class="small-3 columns"><label for="mce-LNAME">Last Name </label></div>
                        <div class="small-9 columns"><input type="text" value="" name="LNAME" class="" id="mce-LNAME"></div>
                    </div>
                </div>
                <div id="mce-responses" class="clear">
                    <div class="response" id="mce-error-response" style="display:none"></div>
                    <div class="response" id="mce-success-response" style="display:none"></div>
                </div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
                <div style="position: absolute; left: -5000px;"><input type="text" name="b_df8bb543c68230d5f7b4dcf78_9a4589f144" tabindex="-1" value=""></div>
                <div class="clear"><input type="submit" class="button" value="Sign up" name="subscribe" id="mc-embedded-subscribe"></div>
            </div>
        </form>
    </div>
</div>

<!-- end newsleter modal -->



<!-- footer.html -->
<footer id="footer">
    <div class="footer-top">
        <a class="logo" href="https://www.scylladb.com"><img src="_static/img/logo-scylla-horizontal-RGB.svg" alt=""></a>
        <div class="footer-links">
            <a class="link" href="https://docs.scylladb.com">Docs</a>
            <a class="link" href="https://www.scylladb.com/company/contact-us/">Contact Us</a>
            <a class="link" href="https://www.scylladb.com/company/">About Us</a>
            <a class="link button" href="https://github.com/scylladb/scylla-operator/issues/new?title=Issue in page Version migrations&&body=I%20would%20like%20to%20report%20an%20issue%20in%20page%20https://operator.docs.scylladb.com/v1.0/migration%0A%0A%23%23%23%20Problem%0A%0A%23%23%23%20%20Suggest%20a%20fix" target="_blank">
                Report an issue on this page</a>
        </div>
        <div class="footer-actions">
            <a class="link-icon" href="https://github.com/ScyllaDB" target="_blank">
                <span class="icon-github2"></span></a>
            <a class="link-icon" href="https://twitter.com/ScyllaDB" target="_blank">
                <span class="icon-twitter"></span></a>
            <a class="link-icon" href="https://www.linkedin.com/company/scylladb"  target="_blank">
                <span class="icon-linkedin2"></span></a>
            <a class="link-icon" href="https://www.facebook.com/scylladb/" target="_blank">
                <span class="icon-facebook"></span></a>
        </div>
    </div>

    <div class="footer-bottom">
        <div class="footer-info">
            <div class="footer-copyright">
                &#169; 2021, ScyllaDB. All rights reserved.
            </div>
            <div class="footer-last-updated">
                Last updated on 10 February 2021.
            </div>
            <div class="footer-version">
                Powered by <a href="http://sphinx-doc.org/">Sphinx 2.4.4</a>
                &amp; <a href="https://pypi.org/project/sphinx-scylladb-theme">ScyllaDB Theme 0.1.21</a>
            </div>
        </div>
        <div class="footer-links">
        </div>
    </div>
</footer>
<!-- end footer.html -->

<!-- bodyscripts.html -->
<!-- at the end of the BODY --> 
<script src="_static/js/vendor/jquery.js"></script>
<script src="_static/js/vendor/jquery.cookie.min.js"></script>
<script src="_static/expertrec.js"></script>
<script src="_static/js/foundation/foundation.js"></script>
<script src="_static/js/foundation/foundation.topbar.js"></script>
<script src="_static/app.js"></script>
<script>
    $(document).foundation();
</script>
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-T8P2JP"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

  <!-- end bodyscripts.html -->
</body>
</html>